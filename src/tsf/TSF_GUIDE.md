# Scripa TSF 输入法安装和使用指南

## 系统要求
- Windows 10/11 (64-bit)
- Visual C++ 2022 Redistributable
- 管理员权限（用于注册）

## 编译步骤

1. **编译DLL**
   ```
   运行: bat\build_tsf.bat
   ```
   这将生成 `build\ScripaTSF.dll`

2. **注册输入法（需要管理员权限）**
   ```
   以管理员身份运行: bat\register.bat
   ```

## 添加到系统

1. 打开 **Windows 设置**
2. 进入 **时间和语言** > **语言和区域**
3. 点击 **添加语言**
4. 选择 **English (United States)**（如果还没有）
5. 点击 **English** > **选项**
6. 在 **键盘** 部分，点击 **添加键盘**
7. 选择 **Scripa IPA**

## 使用方法

### 切换输入法
- 按 **Windows + Space** 或点击任务栏语言图标
- 选择 **Scripa IPA**

### 输入
1. **键入字母**：直接输入IPA转换规则（如 `th`, `dh`, `ng`）
2. **查看候选**：会显示候选转换结果
3. **选择候选**：
   - 按 **Space** 选择第一个候选
   - 按 **数字键 1-9** 选择对应候选（如果实现了候选窗口）
4. **删除字符**：按 **Backspace**

### 切换模式
- 目前支持 IPA 模式和 ENG（直通）模式
- 模式切换需要在候选窗口中操作

## 卸载

1. **从系统移除**
   - Windows 设置 > 语言和区域
   - 移除 Scripa IPA 键盘

2. **注销DLL**（需要管理员权限）
   ```
   以管理员身份运行: bat\unregister.bat
   ```

## 故障排除

### 注册失败
- 确保以管理员身份运行 `register.bat`
- 检查是否有杀毒软件阻止

### 输入法不出现在列表中
- 重启资源管理器：任务管理器 > 重启 Windows 资源管理器
- 注销并重新登录
- 重启电脑

### 输入没有反应
- 检查是否正确选中了 Scripa IPA
- 查看是否在支持的应用程序中（记事本、Word等）
- 某些应用程序（如管理员权限的应用）可能不支持

## 开发和调试

### 查看日志
- TSF 不直接提供日志，但可以：
  1. 使用 Visual Studio 附加调试器到进程
  2. 在代码中添加 `OutputDebugString()` 输出
  3. 使用 DebugView 工具查看调试输出

### 重新编译后更新
1. 运行 `bat\unregister.bat`（管理员）
2. 关闭所有使用输入法的应用
3. 重新编译：`bat\build_tsf.bat`
4. 运行 `bat\register.bat`（管理员）
5. 重启资源管理器或注销

## 已知限制

当前实现的功能：
- ✅ 基本字符输入和转换
- ✅ 组合字符处理
- ✅ Backspace 删除
- ✅ 字典查找和候选生成

尚未实现的功能：
- ❌ 候选窗口UI（使用系统默认）
- ❌ 工具栏按钮（模式切换、设置）
- ❌ 自定义候选窗口样式
- ❌ 完整的键盘响应（数字键选择）

## 下一步开发

要实现完整的UI功能（如demo exe中的功能），需要：
1. 实现 ITfCandidateListUIElement 接口
2. 创建自定义候选窗口（Win32窗口）
3. 添加工具栏按钮
4. 实现完整的按键处理

这些功能将在后续版本中添加。
