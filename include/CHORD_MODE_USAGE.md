# Chord模式使用说明

## 功能概述
Chord模式提供两层输出系统：
1. **第一层**：键盘输入 → 音符名称（通过chord.txt映射）
2. **第二层**：音符序列 → 和弦名称（通过chord2.txt匹配）

## 启用Chord模式
1. 点击 **Settings** 按钮
2. 选择 **Other Settings**
3. 勾选 **Enable Chord Mode**
4. 点击 **Apply**

启用后：
- 窗口高度自动调整为原来的2.2倍
- 显示钢琴键盘界面（7个白键 + 5个黑键）
- 其他所有schemes自动禁用
- 只有chord.txt生效

## 输入方式

### 方式1：键盘输入
1. **输入字符**组成音符代码（如 `c`、`as`、`ctt`等）
2. **按空格键或Enter键**确认当前音符，添加到序列
3. 继续输入下一个音符
4. 右键点击清空整个序列

**示例**：
- 输入 `c` → 按空格 → 添加"C"到序列
- 输入 `as` → 按空格 → 添加"A#"到序列
- 输入 `bt` → 按空格 → 添加"A#"到序列（同一音符的不同输入方式）

### 方式2：点击钢琴键
- 直接点击白键或黑键
- 立即添加对应音符到序列
- 右键点击清空序列

## 显示内容

### Buffer区域
显示当前正在输入的字符（未确认的音符代码）

### 候选栏
- **未完成序列时**：显示当前输入字符对应的候选音符
- **完成序列后**：显示匹配的和弦名称

### 钢琴键盘下方
显示已确认的音符序列，格式：`C + E + G`

## chord.txt 文件格式

```
输入代码1,输入代码2,... 输出音符
```

**示例**：
```
a,gss,btt A
as,bt,ctt A#
c,bs,dtt C
cs,dt C#
```

说明：
- 每行定义一个音符的多种输入方式
- `a`、`gss`、`btt` 都可以输出 "A"
- `as`、`bt`、`ctt` 都可以输出 "A#"

## chord2.txt 文件格式

```
音符序列 和弦名称
```

**示例**：
```
CEG Cmaj
CEbG Cmin
CDG Csus2
CFG Csus4
CEGBb C7
CEGB Cmaj7
```

说明：
- 音符序列不需要分隔符，直接连写：`CEG`
- 包含升降号：`CEbG`（Eb表示E♭）
- 可以定义任意长度的和弦

## 完整示例

**输入C大三和弦**：
1. 输入 `c` → 按空格 → 显示"C"
2. 输入 `e` → 按空格 → 显示"C + E"
3. 输入 `g` → 按空格 → 显示"C + E + G"，候选栏显示"Cmaj"

**输入A#**（多种方式）：
- 方式1：输入 `as` → 按空格
- 方式2：输入 `bt` → 按空格
- 方式3：输入 `ctt` → 按空格
- 方式4：点击钢琴上的黑键（C和D之间）

## 清除操作
- **右键点击**：清空整个音符序列和候选词
- **Backspace**：删除composition中的最后一个字符（未确认音符）
- **选择候选词后**（数字键/Enter/点击）：自动清空序列

## 退出Chord模式
1. 点击 **Settings** → **Other Settings**
2. 取消勾选 **Enable Chord Mode**
3. 点击 **Apply**

退出后：
- 窗口恢复原始高度
- 恢复之前启用的schemes
- chord.txt自动禁用

## 性能优化
- 使用双缓冲绘制，消除闪烁
- 只在内容变化时重绘
- `InvalidateRect` 使用 `FALSE` 参数避免擦除背景
